Path for cluterconfig /home/nikesh/Unified/DIGIT-DevOps/deploy-as-code/helm/charts/cluster-configs
/home/nikesh/Unified/DIGIT-DevOps/deploy-as-code/helm/charts/cluster-configs
Before Trimming/home/nikesh/Unified/DIGIT-DevOps/deploy-as-code/helm
path too sops/home/nikesh/Unified/DIGIT-DevOps/deploy-as-code/
Error Condition: 
stat /home/nikesh/Unified/DIGIT-DevOps/deploy-as-code//.sops.yaml: no such file or directory
---
# Source: estimates/templates/service.yaml
# service.yaml---
apiVersion: v1
kind: Service
metadata:
  name: estimates
  namespace: works  
  annotations: 
    zuul/route-path: estimate 
  labels:
    app: estimates      
    group: digit-works   
spec:
  selector:
    app: estimates      
    group: digit-works    
  ports:
  - name: http
    port: 8080
    targetPort: 8080
---
# Source: estimates/templates/deployment.yaml
# deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: estimates
  namespace: works
  labels:
    app: estimates      
    group: digit-works   
spec:
  selector:
    matchLabels:
      app: estimates      
      group: digit-works
  strategy:
    rollingUpdate:
      maxUnavailable: 0     
  replicas: 1
  template:
    metadata:  
      annotations:      
        deployment-timestamp: "20230623214015"        
      labels:
        app: estimates      
        group: digit-works            
    spec:
      affinity:
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
          - weight: 100
            podAffinityTerm:
              topologyKey: "failure-domain.beta.kubernetes.io/zone"
              labelSelector:
                matchLabels:
                  app: estimates      
                  group: digit-works     
      initContainers:
      
      - name: "db-migration"
        image: egovio/estimates-db:v0.1.2-74302703-23
        imagePullPolicy: IfNotPresent               
        env:
            - name: "DB_URL"
              valueFrom: 
                configMapKeyRef: 
                  name: egov-config
                  key: db-url
            - name: "SCHEMA_TABLE"
              value: "estimates_schema"              
            - name: "FLYWAY_USER"
              valueFrom: 
                secretKeyRef: 
                    name: db
                    key: flyway-username
            - name: "FLYWAY_PASSWORD"
              valueFrom:
                secretKeyRef: 
                    name: db
                    key: flyway-password
            - name: "FLYWAY_LOCATIONS"
              valueFrom: 
                configMapKeyRef: 
                    name: egov-config
                    key: flyway-locations
                        
      containers:      
        - name: estimates
          image: egovio/estimates:v0.1.2-74302703-23
          imagePullPolicy: IfNotPresent             
          ports:
            - name: http
              containerPort: 8080
              protocol: TCP              
          readinessProbe:
            httpGet:
                path: "/estimate/health"
                port: 8080
            initialDelaySeconds: 30
            timeoutSeconds: 3
            periodSeconds: 30
            successThreshold: 1
            failureThreshold: 5        
             
          livenessProbe:
            httpGet:
                path: "/estimate/health"
                port: 8080
            initialDelaySeconds: 30
            timeoutSeconds: 3
            periodSeconds: 60
            successThreshold: 1
            failureThreshold: 5
            
          lifecycle:
            preStop:
              exec:
                command:
                - sh
                - -c
                - sleep 10                         
          env:
            - name: SERVER_PORT
              value: "8080"
            - name: JAVA_OPTS
              value: "-Xmx512m -Xms512m"
            - name: JAVA_ARGS
              value: ""
            - name: TRACER_OPENTRACING_ENABLED
              value: "true"
            - name: SERVER_CONTEXT_PATH
              value: /estimate
            - name: SERVER_SERVLET_CONTEXT-PATH
              value: /estimate
            - name: EGOV_MDMS_HOST
              valueFrom:
                configMapKeyRef:
                  name: egov-service-host
                  key: egov-mdms-service
            - name: EGOV_IDGEN_HOST
              valueFrom:
                configMapKeyRef:
                  name: egov-service-host
                  key: egov-idgen
            - name: EGOV_WORKFLOW_HOST
              valueFrom:
                configMapKeyRef:
                  name: egov-service-host
                  key: egov-workflow-v2
            - name: EGOV_LOCALIZATION_HOST
              valueFrom:
                configMapKeyRef:
                  name: egov-service-host
                  key: egov-localization
            - name: EGOV_HRMS_HOST
              valueFrom:
                configMapKeyRef:
                  name: egov-service-host
                  key: egov-hrms
            - name: EGOV_LOCATION_HOST
              valueFrom:
                configMapKeyRef:
                  name: egov-service-host
                  key: egov-location
            - name: ESTIMATE_KAFKA_CREATE_TOPIC
              value: "save-estimate"
            - name: ESTIMATE_KAFKA_UPDATE_TOPIC
              value: "update-estimate"
            - name: KAFKA_TOPICS_NOTIFICATION_SMS
              value: "egov.core.notification.sms"
            - name: WORKS_PROJECT_SERVICE_HOST
              valueFrom:
                configMapKeyRef:
                  name: egov-service-host
                  key: project-management-system
            - name: SPRING_KAFKA_CONSUMER_GROUP_ID
              value: "estimate-service"
            - name: KAFKA_CONFIG_BOOTSTRAP_SERVER_CONFIG
              valueFrom:
                configMapKeyRef:
                  name: egov-config
                  key: kafka-brokers
            
            - name: SPRING_DATASOURCE_URL
              valueFrom:
                configMapKeyRef:
                  name: egov-config
                  key: db-url
            - name: FLYWAY_ENABLED
              value: "false"      
            - name: SPRING_FLYWAY_ENABLED
              value: "false"      
            - name: MANAGEMENT_ENDPOINTS_WEB_BASE_PATH
              value: "/"
            - name: APP_TIMEZONE
              valueFrom:
                configMapKeyRef:
                  name: egov-config
                  key: timezone              
            - name: FLYWAY_URL
              valueFrom:
                configMapKeyRef:
                  name: egov-config
                  key: db-url
            - name: SPRING_DATASOURCE_USERNAME
              valueFrom:
                secretKeyRef:
                  name: db
                  key: username
            - name: SPRING_DATASOURCE_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: db
                  key: password
            - name: SPRING_DATASOURCE_TOMCAT_INITIAL_SIZE
              valueFrom:
                configMapKeyRef:
                  name: egov-config
                  key: spring-datasource-tomcat-initialSize
            - name: SERVER_TOMCAT_MAX_THREADS        
              valueFrom:
                configMapKeyRef:
                  name: egov-config
                  key: server-tomcat-max-threads            
            - name: SERVER_TOMCAT_MAX_CONNECTIONS        
              valueFrom:
                configMapKeyRef:
                  name: egov-config
                  key: server-tomcat-max-connections                
            - name: SPRING_DATASOURCE_TOMCAT_MAX_ACTIVE 
              valueFrom:
                configMapKeyRef:
                  name: egov-config
                  key: spring-datasource-tomcat-max-active       
            - name: SPRING_DATASOURCE_HIKARI_MAXIMUM-POOL-SIZE
              valueFrom:
                configMapKeyRef:
                  name: egov-config
                  key: spring-datasource-tomcat-max-active           
            - name: KAFKA_CONFIG_BOOTSTRAP_SERVER_CONFIG
              valueFrom:
                configMapKeyRef:
                  name: egov-config
                  key: kafka-brokers
            - name: SPRING_KAFKA_BOOTSTRAP_SERVERS
              valueFrom:
                configMapKeyRef:
                  name: egov-config
                  key: kafka-brokers
            - name: SPRING_JPA_SHOW_SQL
              valueFrom:
                configMapKeyRef:
                  name: egov-config
                  key: spring-jpa-show-sql           
            
            - name: JAEGER_SERVICE_NAME
              value: estimates
            - name: JAEGER_SAMPLER_TYPE
              value: remote
            - name: JAEGER_AGENT_HOST
              valueFrom:
                fieldRef:
                  fieldPath: status.hostIP
            - name: JAEGER_AGENT_PORT
              value: "6831"
            - name: JAEGER_SAMPLER_MANAGER_HOST_PORT
              value: "$(JAEGER_AGENT_HOST):5778"
            - name: TRACER_OPENTRACING_ENABLED
              value: "true"         
                                                 
          resources:
            requests:
              memory: "256Mi"
            limits:
              memory: "256Mi"
---
# Source: estimates/templates/ingress.yaml
# ingress.yaml---
apiVersion: networking.k8s.io/v1 
kind: Ingress
metadata:
  name: estimates
  namespace: egov     
  annotations:
    kubernetes.io/ingress.class: nginx
    nginx.ingress.kubernetes.io/use-regex: "true"
    nginx.ingress.kubernetes.io/lua-resty-waf: active
    nginx.ingress.kubernetes.io/lua-resty-waf-allow-unknown-content-types: "true"
    nginx.ingress.kubernetes.io/lua-resty-waf-debug: "true"
    nginx.ingress.kubernetes.io/lua-resty-waf-process-multipart-body: "false"
    nginx.ingress.kubernetes.io/lua-resty-waf-score-threshold: "10" 
  labels:
    app: estimates      
    group: digit-works                            
spec:
  rules:  
  - host: unified-dev.digit.org  
    http:
      paths:
      - backend:          
          service:
            name: zuul
            port:
              number: 8080
            
        path: /estimate
        pathType: Prefix        
  tls:      
  - hosts:
    - unified-dev.digit.org
    secretName: unified-dev.digit.org-tls-certs

options.ConfigDir: ../../deploy-as-code/helm
